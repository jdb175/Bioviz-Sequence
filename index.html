<!DOCTYPE html>
<meta charset="utf-8">
<style>
</style>
<body>
<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
<script>
  var seq1 = "GAATTCAGTTA"
  var seq2 = "GGATCGA"
  var residueScore = 2;
  var gapPenalty = -2;
  var misMatchPenalty = -1;
  var scores = new Array();
  align();

  function align() {
    //initialize arrays
    for(var i = 0; i <= seq2.length; ++i) {
      scores[i] = new Array;
      scores[i][0] = {val: 0};
    }
    for(var i = 0; i <= seq1.length; ++i) {
      scores[0][i] = {val: 0};
    }

    //set scores
    for(var i = 1; i <= seq2.length; ++i) {
      for(var j = 1; j <= seq1.length; ++j) {
        var oldDiag = scores[i-1][j-1].val, //No gap
            oldGap1 = scores[i][j-1].val, //There is a gap in seq1
            oldGap2 = scores[i-1][j].val; //There is a gap in seq2

        var diag = oldDiag + ((seq2[i-1] == seq1[j-1]) ? residueScore : misMatchPenalty);
        var gap1 = oldGap1 + gapPenalty
        var gap2 = oldGap2 + gapPenalty
        if( diag >= gap1 && diag >= gap2 ) {
          scores[i][j] ={val: diag, point:"diag"};
        } else if ( gap1 >= gap2 ) {
          scores[i][j] ={val: gap1, point:"gap1"};
        } else {
          scores[i][j] ={val: gap2, point:"gap2"};
        }
      }
    }
    printArray();

    //Follow array back
    var i = seq2.length;
    var j = seq1.length;
    var seq1_a = "";
    var seq2_a = "";
    while(i > 0 && j > 0) {
      var cur = scores[i][j];
      switch(cur.point) {
        case "diag":
          seq1_a = seq1[j-1] + seq1_a;
          seq2_a = seq2[i-1] + seq2_a;
          --i;
          --j;
          break;
        case "gap2":
          seq1_a = "_"+seq1_a;
          seq2_a = seq2[i-1] + seq2_a;
          --i;
          break;
        case "gap1":
          seq1_a = seq1[j-1] + seq1_a;
          seq2_a = "_"+seq2_a;
          --j;
          break;
      }
    }
    seq1 = seq1_a;
    seq2 = seq2_a;
  }

  function printArray() {
    var str = "        ";
    for(var k = 0; k < seq1.length; ++k) {
      str += seq1[k] + "   ";
    }
    str +="\n\n";
    for(var i = 0; i <= seq2.length; ++i) {
      lineString = ""
      if(i > 0) {
        lineString+= seq2[i-1] + "   ";
      } else {
        lineString += "    ";
      }  
      for(var j = 0; j <= seq1.length; ++j) {
        lineString+= scores[i][j].val;
        if(scores[i][j].val < 0) {
          lineString += "  ";
        } else {
          lineString += "   ";
        }
      }
      str+= lineString + "\n\n";
    }

    console.log(str);
  }
</script>
